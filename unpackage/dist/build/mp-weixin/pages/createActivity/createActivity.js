(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/createActivity/createActivity"],{"3e0a":function(t,e,n){"use strict";var o=n("6d9d"),i=n.n(o);i.a},"6ba8":function(t,e,n){"use strict";(function(t,e){var o=n("47a9");n("d909"),n("861b");o(n("3240"));var i=o(n("fd2b"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"6d9d":function(t,e,n){},8046:function(t,e,n){"use strict";(function(t,o){var i=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(n("7eb4")),a=i(n("ee10")),s={onShow:function(){try{var e=t.getStorageSync("userInfo"),n=t.getStorageSync("username");console.log("[createActivity.onShow]",{hasUserInfo:!!e,userInfoUsername:e&&e.username,storedUsername:n})}catch(o){}},data:function(){return{form:{name:"",location:"",date:"",timeSlot:"",contact:"",totalPeople:"",description:""},timeSlots:Array.from({length:15},(function(t,e){return"".concat(7+e,":00-").concat(8+e,":00")})),peopleOptions:Array.from({length:9},(function(t,e){return"".concat(e+2)})),peopleIndex:-1,districts:["越秀区","荔湾区","海珠区","天河区","白云区","黄埔区","番禺区","花都区","南沙区","从化区","增城区"],districtIndex:-1,detailAddress:""}},computed:{isFormValid:function(){var t=!!this.form.name&&this.form.name.trim().length>0,e=this.districtIndex>=0,n=!!this.detailAddress&&this.detailAddress.trim().length>0,o=!!this.form.date,i=!!this.form.timeSlot,r=!!this.form.totalPeople&&Number(this.form.totalPeople)>0,a=/^\d{11}$/.test(this.form.contact),s=!!this.form.description&&this.form.description.trim().length>0;return t&&e&&n&&o&&i&&r&&a&&s}},methods:{onSubmitTap:function(){if(this.isFormValid)this.submitActivity();else{var e=this.getFirstInvalidReason();e&&t.showToast({title:e,icon:"none"})}},getFirstInvalidReason:function(){return this.form.name&&this.form.name.trim()?this.districtIndex<0?"请选择活动所在区":this.detailAddress&&this.detailAddress.trim()?this.form.date?this.form.timeSlot?!this.form.totalPeople||Number(this.form.totalPeople)<=0?"请选择活动人数":/^\d{11}$/.test(this.form.contact)?this.form.description&&this.form.description.trim()?"":"请填写详细说明":"请输入11位手机号":"请选择时间段":"请选择活动日期":"请填写详细地址":"请填写活动名称"},onDateChange:function(t){this.form.date=t.detail.value},onTimeSlotChange:function(t){this.form.timeSlot=this.timeSlots[t.detail.value]},onPeopleChange:function(t){this.peopleIndex=t.detail.value,this.form.totalPeople=parseInt(this.peopleOptions[this.peopleIndex])},onDistrictChange:function(t){this.districtIndex=Number(t.detail.value)},resetForm:function(){this.form={name:"",location:"",date:"",timeSlot:"",contact:"",totalPeople:"",description:""},this.peopleIndex=-1,this.districtIndex=-1,this.detailAddress=""},submitActivity:function(){var e=this;return(0,a.default)(r.default.mark((function n(){var i,a,s,c,u,l,d;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=t.getStorageSync("userInfo"),i){n.next=5;break}return t.showToast({title:"请先登录",icon:"none",duration:1500}),setTimeout((function(){t.navigateTo({url:"/pages/login/login"})}),800),n.abrupt("return");case 5:if(a="",s="",e.districtIndex>=0?(a=e.districts[e.districtIndex]||"",s=(e.detailAddress||"").trim(),c=s?" "+s:"",e.form.location="广东省广州市".concat(a).concat(c)):e.form.location="",e.form.name&&e.form.name.trim()){n.next=11;break}return t.showToast({title:"请填写活动名称",icon:"none"}),n.abrupt("return");case 11:if(!(e.districtIndex<0)){n.next=14;break}return t.showToast({title:"请选择活动所在区",icon:"none"}),n.abrupt("return");case 14:if(e.detailAddress&&e.detailAddress.trim()){n.next=17;break}return t.showToast({title:"请填写详细地址",icon:"none"}),n.abrupt("return");case 17:if(e.form.date){n.next=20;break}return t.showToast({title:"请选择活动日期",icon:"none"}),n.abrupt("return");case 20:if(e.form.timeSlot){n.next=23;break}return t.showToast({title:"请选择时间段",icon:"none"}),n.abrupt("return");case 23:if(e.form.totalPeople&&!(Number(e.form.totalPeople)<=0)){n.next=26;break}return t.showToast({title:"请选择活动人数",icon:"none"}),n.abrupt("return");case 26:if(/^\d{11}$/.test(e.form.contact)){n.next=29;break}return t.showToast({title:"请输入11位手机号",icon:"none"}),n.abrupt("return");case 29:if(e.form.description&&e.form.description.trim()){n.next=32;break}return t.showToast({title:"请填写详细说明",icon:"none"}),n.abrupt("return");case 32:if(u=t.getStorageSync("username"),l=u||i&&i.username||"",l){n.next=38;break}return t.showToast({title:"未获取到用户名，请重新登录",icon:"none",duration:2e3}),setTimeout((function(){t.navigateTo({url:"/pages/login/login"})}),800),n.abrupt("return");case 38:try{t.setStorageSync("currentUsername",String(l))}catch(r){}return n.prev=39,t.showLoading({title:"创建中...",mask:!0}),n.next=43,o.callFunction({name:"uploadActivity",data:{name:e.form.name,area:a,location:s,date:e.form.date,timeSlot:e.form.timeSlot,contact:e.form.contact,totalPeople:parseInt(e.form.totalPeople,10),description:e.form.description,joinedPeople:1,creator:l,createdAt:Date.now()},timeout:15e3});case 43:d=n.sent,t.hideLoading(),0===d.result.code?(t.showToast({title:"活动创建成功",icon:"success",duration:1e3}),e.resetForm(),setTimeout((function(){t.switchTab({url:"/pages/index/index",fail:function(){t.reLaunch({url:"/pages/index/index"})}})}),1e3)):t.showToast({title:d.result.message||"活动创建失败",icon:"none",duration:3e3}),n.next=53;break;case 48:n.prev=48,n.t0=n["catch"](39),t.hideLoading(),console.error("提交失败:",n.t0),t.showToast({title:"提交失败: ".concat(n.t0.message||"网络错误"),icon:"none",duration:3e3});case 53:case"end":return n.stop()}}),n,null,[[39,48]])})))()}}};e.default=s}).call(this,n("df3c")["default"],n("861b")["uniCloud"])},"8d1e":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){}));var o=function(){var t=this.$createElement;this._self._c},i=[]},"981b":function(t,e,n){"use strict";n.r(e);var o=n("8046"),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=i.a},fd2b:function(t,e,n){"use strict";n.r(e);var o=n("8d1e"),i=n("981b");for(var r in i)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r);n("3e0a");var a=n("828b"),s=Object(a["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=s.exports}},[["6ba8","common/runtime","common/vendor"]]]);