(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/editActivity/editActivity"],{"00b1":function(t,e,i){"use strict";(function(t,e){var n=i("47a9");i("d909"),i("861b");n(i("3240"));var r=n(i("e478"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(r.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"18a6":function(t,e,i){},"50ce":function(t,e,i){"use strict";(function(t,n){var r=i("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(i("7eb4")),a=r(i("ee10")),s=r(i("7ca3"));function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(Object(i),!0).forEach((function(e){(0,s.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var d={data:function(){return{activityId:"",form:{name:"",date:"",timeSlot:"",contact:"",totalPeople:"",description:""},originalLocation:"",districtOptions:["越秀区","荔湾区","海珠区","天河区","白云区","黄埔区","番禺区","花都区","南沙区","从化区","增城区"],districtIndex:-1,detailAddress:"",timeSlots:["上午 9:00-11:00","中午 11:00-13:00","下午 14:00-17:00","晚上 18:00-21:00"],peopleOptions:["2","3","4","5","6","7","8","9","10","12","15","20","30","50"],peopleIndex:-1}},computed:{isFormValid:function(){return!(!this.form.name||!this.form.name.trim())&&(!(this.districtIndex<0)&&(!(!this.detailAddress||!this.detailAddress.trim())&&(!!this.form.date&&(!!this.form.timeSlot&&(!!/^\d{11}$/.test(this.form.contact)&&(!(!this.form.totalPeople||Number(this.form.totalPeople)<=0)&&!(!this.form.description||!this.form.description.trim())))))))},assembledLocation:function(){if(this.districtIndex<0)return"";var t=this.districtOptions[this.districtIndex],e=(this.detailAddress||"").trim();return e?"广东省广州市".concat(t," ").concat(e):"广东省广州市".concat(t)},displayLocation:function(){return this.assembledLocation||this.originalLocation||""}},onLoad:function(e){var i=this;if(e&&e.id){this.activityId=e.id;try{var n=this.getOpenerEventChannel&&this.getOpenerEventChannel();n&&n.on&&n.on("activityPrefill",(function(t){var e=t.activity;e&&i.prefill(e)}))}catch(r){}this.loadDetail()}else t.showModal({title:"错误",content:"缺少活动ID",showCancel:!1,complete:function(){return t.navigateBack()}})},methods:{prefill:function(t){var e={name:t.name||"",date:t.date||"",timeSlot:t.timeSlot||"",contact:t.contact||"",totalPeople:t.totalPeople||"",description:t.description||""};this.form=l(l({},this.form),e);var i=t.area||"",n=t.location||"";if(i){var r=this.districtOptions.findIndex((function(t){return String(t)===String(i)}));this.districtIndex=r,this.detailAddress=n||"";var o="广东省广州市".concat(i).concat(n?" "+n:"");this.originalLocation=o}else this.originalLocation=t.location||"",this.parseLocation(this.originalLocation);var a=this.peopleOptions.findIndex((function(t){return Number(t)===Number(e.totalPeople)}));this.peopleIndex=a},loadDetail:function(){var t=this;return(0,a.default)(o.default.mark((function e(){var i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.callFunction({name:"getActivityDetail",data:{id:t.activityId}});case 3:i=e.sent,i.result&&0===i.result.code&&i.result.data&&t.prefill(i.result.data),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.warn("加载详情失败",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},onDateChange:function(t){this.form.date=t.detail.value},onTimeSlotChange:function(t){this.form.timeSlot=this.timeSlots[Number(t.detail.value)]},onPeopleChange:function(t){this.peopleIndex=Number(t.detail.value),this.form.totalPeople=Number(this.peopleOptions[this.peopleIndex])},onDistrictChange:function(t){this.districtIndex=Number(t.detail.value)},parseLocation:function(t){try{if(!t)return;var e=String(t),i=e.replace(/\s+/g,"").replace("广东省","").replace("广州市",""),n=this.districtOptions.findIndex((function(t){return i.includes(t)}));if(n>=0){this.districtIndex=n;var r=this.districtOptions[n],o=i.split(r)[1]||"";this.detailAddress=(o||"").trim()}}catch(a){}},onSubmitTap:function(){if(this.isFormValid)this.submit();else{var e=this.firstInvalidReason();e&&t.showToast({title:e,icon:"none"})}},firstInvalidReason:function(){return this.form.name&&this.form.name.trim()?this.districtIndex<0?"请选择活动所在区":this.detailAddress&&this.detailAddress.trim()?this.form.date?this.form.timeSlot?/^\d{11}$/.test(this.form.contact)?!this.form.totalPeople||Number(this.form.totalPeople)<=0?"请选择活动人数":this.form.description&&this.form.description.trim()?"":"请填写详细说明":"请输入11位手机号":"请选择时间段":"请选择活动日期":"请填写详细地址":"请填写活动名称"},submit:function(){var e=this;return(0,a.default)(o.default.mark((function i(){var r,a;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(r=t.getStorageSync("username")||"",r){i.next=4;break}return t.showToast({title:"请先登录",icon:"none"}),i.abrupt("return");case 4:return i.prev=4,t.showLoading({title:"保存中...",mask:!0}),i.next=8,n.callFunction({name:"updateActivity",data:l(l({id:e.activityId,username:r},e.form),{},{area:e.districtIndex>=0?e.districtOptions[e.districtIndex]:"",location:(e.detailAddress||"").trim()})});case 8:if(a=i.sent,!a.result||0!==a.result.code){i.next=14;break}t.showToast({title:"保存成功",icon:"success"}),setTimeout((function(){t.navigateBack()}),800),i.next=15;break;case 14:throw new Error(a.result&&a.result.message||"保存失败");case 15:i.next=20;break;case 17:i.prev=17,i.t0=i["catch"](4),t.showToast({title:i.t0.message||"保存失败",icon:"none"});case 20:return i.prev=20,t.hideLoading(),i.finish(20);case 23:case"end":return i.stop()}}),i,null,[[4,17,20,23]])})))()}}};e.default=d}).call(this,i("df3c")["default"],i("861b")["uniCloud"])},"9f75":function(t,e,i){"use strict";var n=i("18a6"),r=i.n(n);r.a},e478:function(t,e,i){"use strict";i.r(e);var n=i("e64e"),r=i("f41e");for(var o in r)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return r[t]}))}(o);i("9f75");var a=i("828b"),s=Object(a["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=s.exports},e64e:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){}));var n=function(){var t=this.$createElement;this._self._c},r=[]},f41e:function(t,e,i){"use strict";i.r(e);var n=i("50ce"),r=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e["default"]=r.a}},[["00b1","common/runtime","common/vendor"]]]);