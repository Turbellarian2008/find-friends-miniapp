(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"47ba":function(e,t,i){"use strict";i.r(t);var n=i("fe55"),a=i("4a38");for(var r in a)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(r);i("da0f");var l=i("828b"),c=Object(l["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=c.exports},"4a38":function(e,t,i){"use strict";i.r(t);var n=i("d0a8"),a=i.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r);t["default"]=a.a},a451:function(e,t,i){},d0a8:function(e,t,i){"use strict";(function(e,n){var a=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(i("7eb4")),l=a(i("7ca3")),c=a(i("ee10"));function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){(0,l.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var u={data:function(){return{selectedDate:null,selectedTime:null,selectedAreaIndex:null,areas:["越秀区","荔湾区","海珠区","天河区","白云区","黄埔区","番禺区","花都区","南沙区","从化区","增城区"],searchQuery:"",tempDatePickerValue:"",filterDrawerVisible:!1,filterActiveTab:"date",tempSelectedDate:null,tempSelectedTime:null,tempSelectedAreaIndex:null,dateOptions:[],timeSlots:Array.from({length:15},(function(e,t){return"".concat(7+t,":00-").concat(8+t,":00")})),activityList:[],refreshing:!1,loading:!1}},computed:{displayedActivities:function(){var e=this;return this.selectedDate||this.selectedTime||null!==this.selectedAreaIndex||this.searchQuery?this.activityList.filter((function(t){var i=!e.selectedDate||t.date===e.selectedDate,n=!e.selectedTime||t.timeSlot===e.timeSlots[e.selectedTime],a=null===e.selectedAreaIndex||t.area===e.areas[e.selectedAreaIndex],r=(e.searchQuery||"").trim().toLowerCase(),l=!r||String(t.name||"").toLowerCase().includes(r);return i&&n&&a&&l})):this.activityList}},onLoad:function(){this.loadActivities()},onShow:function(){console.log("首页显示，刷新活动数据..."),this.loadActivities()},onPullDownRefresh:function(){this.refreshing=!0,this.loadActivities()},methods:{onDateChange:function(e){this.selectedDate=e.detail.value,console.log("选择的日期:",this.selectedDate)},openFilterDrawer:function(){this.tempSelectedDate=this.selectedDate||null,this.tempSelectedTime=null!==this.selectedTime?this.selectedTime:null,this.tempSelectedAreaIndex=null!==this.selectedAreaIndex?this.selectedAreaIndex:null,this.tempDatePickerValue=this.selectedDate||"",this.filterActiveTab="date",this.filterDrawerVisible=!0},closeFilterDrawer:function(){this.filterDrawerVisible=!1},onClearTempFilters:function(){this.tempSelectedDate=null,this.tempSelectedTime=null,this.tempSelectedAreaIndex=null,this.tempDatePickerValue=""},onConfirmTempFilters:function(){this.selectedDate=this.tempSelectedDate,this.selectedTime=this.tempSelectedTime,this.selectedAreaIndex=this.tempSelectedAreaIndex,this.filterDrawerVisible=!1},clearTempDate:function(){this.tempSelectedDate=null,this.tempDatePickerValue=""},onTempDatePicked:function(e){var t=e.detail&&e.detail.value?e.detail.value:"";this.tempDatePickerValue=t,this.tempSelectedDate=t||null},onTimeChange:function(e){this.selectedTime=e.detail.value,console.log("选择的时间段索引:",this.selectedTime,"值:",this.timeSlots[this.selectedTime])},loadActivities:function(){var t=this;return(0,c.default)(r.default.mark((function i(){var a,l,c;return r.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,console.log("开始加载活动数据..."),t.loading=!0,e.showLoading({title:"加载中..."}),a=(new Date).getTime(),i.next=7,n.callFunction({name:"getActivities",data:{_t:a},timeout:1e4});case 7:if(l=i.sent,console.log("获取到的活动数据:",l),0!==l.result.code){i.next=17;break}t.activityList=l.result.data.map((function(e){return o(o({},e),{},{id:e.id||e._id})})),c=Array.from(new Set(t.activityList.map((function(e){return e.date})).filter(Boolean)));try{c.sort()}catch(r){}t.dateOptions=c,console.log("成功加载活动数据，数量:",t.activityList.length),i.next=18;break;case 17:throw new Error(l.result.message||"加载活动失败");case 18:i.next=24;break;case 20:i.prev=20,i.t0=i["catch"](0),console.error("加载活动错误:",i.t0),e.showToast({title:"加载失败: "+(i.t0.message||"网络错误"),icon:"none",duration:3e3});case 24:return i.prev=24,t.loading=!1,t.refreshing=!1,e.hideLoading(),e.stopPullDownRefresh(),i.finish(24);case 30:case"end":return i.stop()}}),i,null,[[0,20,24,30]])})))()},onAreaChange:function(e){this.selectedAreaIndex=Number(e.detail.value),console.log("选择的地区索引:",this.selectedAreaIndex,"值:",this.areas[this.selectedAreaIndex])},viewDetail:function(t){var i=t&&t.currentTarget&&t.currentTarget.dataset||{};console.log("查看详情点击，dataset:",i);var n=i.id,a=null;if(n&&(a=this.activityList.find((function(e){return(e.id||e._id)===n}))||null),!a){var r="undefined"!==typeof i.index?Number(i.index):void 0;a="undefined"!==typeof r?this.displayedActivities[r]:null}if(!a)return console.error("错误：活动数据为空",a),void e.showToast({title:"活动数据无效",icon:"none",duration:2e3});var l=a.id||a._id;if(!l)return console.error("错误：活动缺少 id/_id",a),void e.showToast({title:"活动数据缺少id",icon:"none",duration:2e3});var c="/pages/detailActivity/detailActivity?id=".concat(encodeURIComponent(l));console.log("跳转详情页，参数:",{id:l,url:c}),e.navigateTo({url:c,success:function(e){try{e.eventChannel&&e.eventChannel.emit&&e.eventChannel.emit("activityPrefill",{activity:a})}catch(t){console.warn("eventChannel 传递活动数据失败，不影响跳转:",t)}},fail:function(t){console.error("跳转失败:",t),e.showToast({title:"跳转页面失败",icon:"none",duration:2e3})}})},createActivity:function(){console.log("创建新活动按钮被点击"),e.navigateTo({url:"/pages/createActivity/createActivity",fail:function(t){console.error("跳转失败:",t),e.showToast({title:"跳转失败，请检查页面是否存在",icon:"none"})}})},resetFilters:function(){this.selectedDate=null,this.selectedTime=null,this.selectedAreaIndex=null,this.searchQuery="",e.showToast({title:"已清除筛选条件",icon:"success"})},loadActivityDetail:function(){var e=this;return(0,c.default)(r.default.mark((function t(){var i;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.callFunction({name:"getActivityDetail",data:{id:e.activityId}});case 3:if(i=t.sent,console.log("云函数返回数据:",i.result),0!==i.result.code){t.next=9;break}e.activityData=o(o({},e.activityData),i.result.data),t.next=10;break;case 9:throw new Error(i.result.message||"数据加载失败");case 10:t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0),console.error("详情加载失败:",t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))()}}};t.default=u}).call(this,i("df3c")["default"],i("861b")["uniCloud"])},da0f:function(e,t,i){"use strict";var n=i("a451"),a=i.n(n);a.a},e014:function(e,t,i){"use strict";(function(e,t){var n=i("47a9");i("d909"),i("861b");n(i("3240"));var a=n(i("47ba"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(a.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},fe55:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,i=(e._self._c,!e.loading&&0===e.activityList.length);e._isMounted||(e.e0=function(t){e.filterActiveTab="date"},e.e1=function(t){e.filterActiveTab="time"},e.e2=function(t){e.filterActiveTab="area"},e.e3=function(t,i){var n=arguments[arguments.length-1].currentTarget.dataset,a=n.eventParams||n["event-params"];i=a.idx;e.tempSelectedTime=i},e.e4=function(t,i){var n=arguments[arguments.length-1].currentTarget.dataset,a=n.eventParams||n["event-params"];i=a.idx;e.tempSelectedAreaIndex=i}),e.$mp.data=Object.assign({},{$root:{g0:i}})},a=[]}},[["e014","common/runtime","common/vendor"]]]);