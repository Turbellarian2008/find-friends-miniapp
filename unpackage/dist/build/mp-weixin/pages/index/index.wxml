<view class="activities-container"><block wx:if="{{refreshing}}"><view class="refresh-container"><text class="refresh-text">刷新中...</text></view></block><block wx:if="{{filterDrawerVisible}}"><view data-event-opts="{{[['tap',[['closeFilterDrawer',['$event']]]]]}}" class="drawer-mask" bindtap="__e"></view></block><view class="{{['filter-drawer',(filterDrawerVisible)?'show':'']}}"><view class="drawer-header">筛选</view><view class="drawer-body"><view class="drawer-left"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="{{['drawer-tab',(filterActiveTab==='date')?'active':'']}}" bindtap="__e">日期</view><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" class="{{['drawer-tab',(filterActiveTab==='time')?'active':'']}}" bindtap="__e">时间段</view><view data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" class="{{['drawer-tab',(filterActiveTab==='area')?'active':'']}}" bindtap="__e">地区</view></view><view class="drawer-right"><block wx:if="{{filterActiveTab==='date'}}"><view class="option-list option-list-column"><picker mode="date" value="{{tempDatePickerValue}}" data-event-opts="{{[['change',[['onTempDatePicked',['$event']]]]]}}" bindchange="__e"><view class="{{['option-item',(!!tempSelectedDate)?'selected':'']}}">{{''+(tempSelectedDate||'选择')+''}}</view></picker></view></block><block wx:else><block wx:if="{{filterActiveTab==='time'}}"><view class="option-list"><block wx:for="{{timeSlots}}" wx:for-item="t" wx:for-index="idx"><view data-event-opts="{{[['tap',[['e3',['$event']]]]]}}" data-event-params="{{({idx})}}" class="{{['option-item',(tempSelectedTime===idx)?'selected':'']}}" bindtap="__e">{{t}}</view></block></view></block><block wx:else><block wx:if="{{filterActiveTab==='area'}}"><view class="option-list"><block wx:for="{{areas}}" wx:for-item="a" wx:for-index="idx"><view data-event-opts="{{[['tap',[['e4',['$event']]]]]}}" data-event-params="{{({idx})}}" class="{{['option-item',(tempSelectedAreaIndex===idx)?'selected':'']}}" bindtap="__e">{{a}}</view></block></view></block></block></block></view></view><view class="drawer-actions"><button data-event-opts="{{[['tap',[['onClearTempFilters',['$event']]]]]}}" class="btn-clear" bindtap="__e">清空</button><button data-event-opts="{{[['tap',[['onConfirmTempFilters',['$event']]]]]}}" class="btn-ok" bindtap="__e">完成</button></view></view><view class="search-container"><input class="search-input" placeholder="搜索活动名称" confirm-type="search" data-event-opts="{{[['input',[['__set_model',['','searchQuery','$event',['trim']]]]],['blur',[['$forceUpdate']]]]}}" value="{{searchQuery}}" bindinput="__e" bindblur="__e"/></view><view class="toolbar"><button data-event-opts="{{[['tap',[['openFilterDrawer',['$event']]]]]}}" class="filter-toggle" bindtap="__e"><image class="filter-icon" src="/static/icons/筛选.png" mode="aspectFit"></image><text class="filter-text">筛选</text></button></view><block wx:for="{{displayedActivities}}" wx:for-item="activity" wx:for-index="index"><view class="activity-card"><view class="activity-info"><text class="activity-name">{{activity.name}}</text><text class="activity-location">{{activity.location}}</text><text class="activity-time">{{activity.date+" "+activity.timeSlot}}</text><text class="activity-count">{{"需要人数: "+activity.totalPeople+" / 已报名: "+activity.joinedPeople}}</text></view><button class="detail-button" data-id="{{activity.id||activity._id}}" data-index="{{index}}" data-event-opts="{{[['tap',[['viewDetail',['$event']]]]]}}" bindtap="__e">查看详情</button></view></block><block wx:if="{{$root.g0}}"><view class="empty-tips"><text>暂无活动，下拉刷新或点击底部"创建"发起活动</text></view></block></view>