(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/userInfo/userInfo"],{1336:function(e,n,r){"use strict";r.r(n);var t=r("2754"),o=r("f35c");for(var a in o)["default"].indexOf(a)<0&&function(e){r.d(n,e,(function(){return o[e]}))}(a);r("e064");var i=r("828b"),s=Object(i["a"])(o["default"],t["b"],t["c"],!1,null,null,null,!1,t["a"],void 0);n["default"]=s.exports},2754:function(e,n,r){"use strict";r.d(n,"b",(function(){return t})),r.d(n,"c",(function(){return o})),r.d(n,"a",(function(){}));var t=function(){var e=this.$createElement;this._self._c},o=[]},"2f86":function(e,n,r){"use strict";(function(e,n){var t=r("47a9");r("d909"),r("861b");t(r("3240"));var o=t(r("1336"));e.__webpack_require_UNI_MP_PLUGIN__=r,n(o.default)}).call(this,r("3223")["default"],r("df3c")["createPage"])},"7f26":function(e,n,r){},da63:function(e,n,r){"use strict";(function(e,t){var o=r("47a9");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=o(r("7eb4")),i=o(r("ee10")),s=o(r("7ca3"));function c(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function u(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?c(Object(r),!0).forEach((function(n){(0,s.default)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var f={data:function(){return{form:{nickname:"",gender:0,bio:""},originalForm:{},genderOptions:["未知","男","女"],saving:!1,readOnly:!1,viewUsername:""}},computed:{hasChanged:function(){var e={nickname:this.form.nickname,gender:this.form.gender,bio:this.form.bio},n={nickname:this.originalForm.nickname,gender:this.originalForm.gender,bio:this.originalForm.bio};return JSON.stringify(e)!==JSON.stringify(n)}},onLoad:function(n){try{var r=e.getStorageSync("username")||"",t=n&&n.username?String(n.username):"";if(t&&t!==r)return this.readOnly=!0,this.viewUsername=t,void this.loadPublicUserInfo(t)}catch(o){}this.readOnly=!1,this.viewUsername="",this.loadUserInfo()},methods:{loadUserInfo:function(){var n=e.getStorageSync("userInfo");n&&(this.form={nickname:n.nickname||n.username||"",gender:n.gender||0,bio:n.bio||""},this.originalForm=u({},this.form))},loadPublicUserInfo:function(n){var r=this;return(0,i.default)(a.default.mark((function o(){var i,s,c;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(n){o.next=2;break}return o.abrupt("return");case 2:return o.prev=2,e.showLoading({title:"加载中...",mask:!0}),o.next=6,t.callFunction({name:"getUserPublicInfo",data:{username:String(n)},timeout:1e4});case 6:i=o.sent,s=i&&i.result||{},0===s.code&&s.data?(c=s.data,r.form={nickname:c.nickname||c.username||"",gender:"number"===typeof c.gender?c.gender:0,bio:c.bio||""},r.originalForm=u({},r.form)):e.showToast({title:s.message||"加载失败",icon:"none"}),o.next=15;break;case 11:o.prev=11,o.t0=o["catch"](2),console.error("加载公开资料失败:",o.t0),e.showToast({title:o.t0.message||"加载失败",icon:"none"});case 15:return o.prev=15,e.hideLoading(),o.finish(15);case 18:case"end":return o.stop()}}),o,null,[[2,11,15,18]])})))()},onGenderChange:function(e){this.form.gender=parseInt(e.detail.value)},saveUserInfo:function(){var n=this;return(0,i.default)(a.default.mark((function r(){var o,i,s,c;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.form.nickname.trim()){r.next=3;break}return e.showToast({title:"请输入昵称",icon:"none"}),r.abrupt("return");case 3:if(r.prev=3,n.saving=!0,o=e.getStorageSync("username"),o){r.next=8;break}throw new Error("未登录或缺少用户名");case 8:return r.next=10,t.callFunction({name:"updateUserInfo",data:{username:String(o),nickname:n.form.nickname.trim(),bio:String(n.form.bio||""),gender:Number.isInteger(n.form.gender)?n.form.gender:parseInt(n.form.gender)||0},timeout:1e4});case 10:if(i=r.sent,0!==i.result.code){r.next=20;break}s=e.getStorageSync("userInfo"),c=u(u({},s),{},{nickname:n.form.nickname.trim(),bio:String(n.form.bio||""),gender:Number.isInteger(n.form.gender)?n.form.gender:parseInt(n.form.gender)||0}),e.setStorageSync("userInfo",c),n.originalForm=u(u({},n.originalForm),{},{nickname:n.form.nickname.trim(),bio:String(n.form.bio||""),gender:Number.isInteger(n.form.gender)?n.form.gender:parseInt(n.form.gender)||0}),e.showToast({title:"保存成功",icon:"success"}),setTimeout((function(){e.navigateBack()}),1500),r.next=21;break;case 20:throw new Error(i.result.message||"保存失败");case 21:r.next=27;break;case 23:r.prev=23,r.t0=r["catch"](3),console.error("保存用户信息失败:",r.t0),e.showToast({title:r.t0.message||"保存失败，请重试",icon:"none"});case 27:return r.prev=27,n.saving=!1,r.finish(27);case 30:case"end":return r.stop()}}),r,null,[[3,23,27,30]])})))()}}};n.default=f}).call(this,r("df3c")["default"],r("861b")["uniCloud"])},e064:function(e,n,r){"use strict";var t=r("7f26"),o=r.n(t);o.a},f35c:function(e,n,r){"use strict";r.r(n);var t=r("da63"),o=r.n(t);for(var a in t)["default"].indexOf(a)<0&&function(e){r.d(n,e,(function(){return t[e]}))}(a);n["default"]=o.a}},[["2f86","common/runtime","common/vendor"]]]);