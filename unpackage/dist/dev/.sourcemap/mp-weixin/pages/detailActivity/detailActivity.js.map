{"version":3,"sources":["uni-app:///main.js","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/detailActivity/detailActivity.vue?7f76","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/detailActivity/detailActivity.vue?a711","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/detailActivity/detailActivity.vue?1f7d","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/detailActivity/detailActivity.vue?c0ad","uni-app:///pages/detailActivity/detailActivity.vue","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/detailActivity/detailActivity.vue?1c7a","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/detailActivity/detailActivity.vue?922d"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","activityId","activityData","id","name","area","location","date","timeSlot","endtime","totalPeople","joinedPeople","contact","description","type","creatorName","participantsInfo","computed","fullAddress","isOwner","hasJoined","onLoad","console","uni","title","content","showCancel","complete","eventChannel","methods","prefillActivity","participants","loadActivityDetail","mask","uniCloud","timeout","res","message","stack","confirmText","success","handleJoin","username","avatar","userInfo","icon","setTimeout","url","list","exists","out","result","next","canonicalId","joinTime","msg","goEditActivity","activity","confirmDelete","m","deleteActivity","fail","goUserProfileTap","goUserProfile","loadParticipantsInfo","r"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,uBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA2H;AAC3H;AACkE;AACL;AACa;;;AAG1E;AACgN;AAChN,gBAAgB,iNAAU;AAC1B,EAAE,oFAAM;AACR,EAAE,yFAAM;AACR,EAAE,kGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,6FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAA40B,CAAgB,4yBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eC6Dh2B;EACAC;IACA;MACAC;MACAC;QACAC;QACAC;QACA;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;IACA;EACA;EACAC;IACAC;MACA;MACA;MACA;QACA;QACA;MACA;MACA;IACA;IACAC;MACA;QACA;QACA;QACA;MACA;QACA;MACA;IACA;IACAC;MACA;QACA;QACA;QACA;UAAA;QAAA;MACA;QACA;MACA;IACA;EACA;EACAC;IAAA;IACA;IACA;MACA;MACAC;MACAC;QACAC;QACAC;QACAC;QACAC;UAAA;QAAA;MACA;IACA;;IAEA;IACA;MACA;MACA;IACA;MACA;IACA;IACAL;MAAAnB;IAAA;IACA;IACA;MACA;MACAoB;MACA;MACAA;IACA;IAEA;MACA;MACAD;MACAC;QACAC;QACAC;QACAC;QACAC;UAAA;QAAA;MACA;I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","file":"pages/detailActivity/detailActivity.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/detailActivity/detailActivity.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./detailActivity.vue?vue&type=template&id=c2173e74&\"\nvar renderjs\nimport script from \"./detailActivity.vue?vue&type=script&lang=js&\"\nexport * from \"./detailActivity.vue?vue&type=script&lang=js&\"\nimport style0 from \"./detailActivity.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/detailActivity/detailActivity.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detailActivity.vue?vue&type=template&id=c2173e74&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.hasJoined && _vm.participantsInfo.length\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detailActivity.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detailActivity.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"detail-container\">\n    <!-- 活动名称与类型标签 -->\n    <view class=\"title-row\">\n      <text v-if=\"activityData.type\" class=\"category-tag title-category\">{{ activityData.type }}</text>\n      <view class=\"title\">{{ activityData.name }}</view>\n    </view>\n    \n    <!-- 活动详情卡片 -->\n    <view class=\"detail-card\">\n      <view class=\"detail-item\">\n        <text class=\"detail-label\">活动地点：</text>\n        <text class=\"detail-value\">{{ fullAddress }}</text>\n      </view>\n      \n      <view class=\"detail-item\">\n        <text class=\"detail-label\">活动时间：</text>\n        <text class=\"detail-value\">{{ activityData.date }} {{ activityData.timeSlot }}{{ activityData.endtime ? (' - ' + activityData.endtime) : '' }}</text>\n      </view>\n      \n      <view class=\"detail-item\">\n        <text class=\"detail-label\">参与人数：</text>\n        <text class=\"detail-value\">{{ activityData.joinedPeople || 0 }} / {{ activityData.totalPeople }}</text>\n      </view>\n      \n      <view class=\"detail-item\">\n        <text class=\"detail-label\">联系方式：</text>\n        <text class=\"detail-value\">{{ activityData.contact || '未提供' }}</text>\n      </view>\n      \n      <view class=\"detail-item description\">\n        <text class=\"detail-label\">活动说明：</text>\n        <text class=\"detail-value\">{{ activityData.description || '暂无详细说明' }}</text>\n      </view>\n    </view>\n    \n    <!-- 不是创建者：报名/退出 按钮，根据是否已报名切换文案 -->\n    <button\n      :class=\"['join-button', hasJoined ? 'leave-button' : '']\"\n      :type=\"hasJoined ? 'warn' : 'primary'\"\n      v-if=\"!isOwner\"\n      @click=\"handleJoin\"\n    >{{ hasJoined ? '退出活动' : '立即报名' }}</button>\n\n    <!-- 创建者可见：编辑/删除按钮 -->\n    <view class=\"owner-actions\" v-else>\n      <button class=\"edit-button\" @click=\"goEditActivity\">编辑活动</button>\n      <button class=\"delete-button\" @click=\"confirmDelete\">删除活动</button>\n    </view>\n\n    <!-- 参与者列表：仅当当前账号已加入时展示，显示为 用户名（昵称） -->\n    <view v-if=\"hasJoined && participantsInfo.length\" class=\"participants-card\">\n      <view class=\"participants-title\">参加人员</view>\n      <view class=\"participants-item\" v-for=\"(p, idx) in participantsInfo\" :key=\"'p-'+idx\" @click=\"goUserProfileTap\" :data-username=\"p.username\">\n        <text class=\"participants-link\">{{ p.username }}（{{ p.nickname || p.username }}）</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      activityId: '',\n      activityData: {\n        id: '',\n        name: '',\n        // 拆分：area 区，location 详细地址（已移除街道）\n        area: '',\n        location: '',\n        date: '',\n        timeSlot: '',\n        endtime: '',\n        totalPeople: 0,\n        joinedPeople: 0,\n        contact: '',\n        description: '',\n        type: '',\n        creatorName: ''\n      },\n      participantsInfo: []\n    }\n  },\n  computed: {\n    fullAddress() {\n      const area = this.activityData.area || '';\n      const detail = this.activityData.location || '';\n      if (area || detail) {\n        const detailPart = detail ? (' ' + detail) : '';\n        return `广东省广州市${area}${detailPart}`;\n      }\n      return '未设置';\n    },\n    isOwner() {\n      try {\n        const uname = uni.getStorageSync('username') || '';\n        const creator = this.activityData.creatorName || '';\n        return uname && creator && String(uname) === String(creator);\n      } catch (_) {\n        return false;\n      }\n    },\n    hasJoined() {\n      try {\n        const uname = uni.getStorageSync('username') || '';\n        const list = Array.isArray(this.activityData.participants) ? this.activityData.participants : [];\n        return !!(uname && list.some(p => String(p && p.username) === String(uname)));\n      } catch (_) {\n        return false;\n      }\n    }\n  },\n  onLoad(options) {\n    // 仅使用 id 作为活动标识\n    if (!options || !options.id) {\n      const errorMsg = '活动标识缺失（需要 id）';\n      console.error(errorMsg, '参数:', options);\n      uni.showModal({\n        title: '错误',\n        content: errorMsg,\n        showCancel: false,\n        complete: () => uni.navigateBack()\n      });\n    }\n    \n    // 记录传入的 id，并做解码与清理\n    try {\n      const rawId = options.id || '';\n      this.activityId = decodeURIComponent(String(rawId)).trim();\n    } catch (_) {\n      this.activityId = (options.id || '').trim();\n    }\n    console.log('加载活动详情，参数:', { id: this.activityId });\n    // 进入详情页即记录当前活动ID，供后续报名使用\n    try {\n      const toStoreId = String(this.activityId || '');\n      uni.setStorageSync('currentActivityId', toStoreId);\n      // 兼容用户指定的键名\n      uni.setStorageSync('activityid', toStoreId);\n    } catch (_) {}\n\n    if (!this.activityId) {\n      const errorMsg = '活动标识无效';\n      console.error(errorMsg);\n      uni.showModal({\n        title: '错误',\n        content: errorMsg,\n        showCancel: false,\n        complete: () => uni.navigateBack()\n      });\n    }\n\n    // 通过 eventChannel 接收上一页传来的活动数据，先行预渲染，提升体验\n    try {\n      const eventChannel = this.getOpenerEventChannel && this.getOpenerEventChannel();\n      if (eventChannel && eventChannel.on) {\n        eventChannel.on('activityPrefill', ({ activity }) => {\n          console.log('收到预填充活动数据:', activity);\n          if (activity) {\n            this.prefillActivity(activity);\n          }\n        });\n      }\n    } catch (e) {\n      console.warn('获取 eventChannel 失败（可能是直达打开详情页）:', e);\n    }\n    \n    this.loadActivityDetail();\n  },\n  methods: {\n    prefillActivity(activity) {\n      // 规范化字段并带默认值，避免模板渲染报空\n      const normalized = {\n        id: activity.id || activity._id || '',\n        name: activity.name || '未命名活动',\n        area: activity.area || '',\n        location: activity.location || '',\n        date: activity.date || '未设置日期',\n        timeSlot: activity.timeSlot || '未设置时间',\n        endtime: activity.endtime || '',\n        totalPeople: activity.totalPeople || 0,\n        joinedPeople: activity.joinedPeople || 0,\n        participants: Array.isArray(activity.participants) ? activity.participants : [],\n        contact: activity.contact || '未提供',\n        description: activity.description || '暂无详细说明',\n        type: activity.type || '',\n        creatorName: activity.creatorName || activity.creator || ''\n      };\n      this.activityData = { ...this.activityData, ...normalized };\n      // 同步一份活动ID到本地存储，确保 handleJoin 使用同一ID\n      try {\n        if (normalized.id) {\n          const nid = String(normalized.id);\n          uni.setStorageSync('currentActivityId', nid);\n          // 兼容用户指定的键名\n          uni.setStorageSync('activityid', nid);\n        }\n      } catch (_) {}\n    },\n    async loadActivityDetail() {\n      if (!this.activityId) {\n        console.error('活动标识为空');\n        return;\n      }\n      \n      try {\n        uni.showLoading({ title: '加载中...', mask: true });\n        \n        console.log('正在请求活动详情，参数:', { id: this.activityId });\n        const res = await uniCloud.callFunction({\n          name: 'getActivityDetail',\n          data: { id: this.activityId },\n          timeout: 10000\n        });\n        \n        console.log('获取到活动详情响应:', res);\n        \n        if (res.result.code === 0) {\n          // 确保数据格式正确\n          if (!res.result.data) {\n            throw new Error('返回的活动数据为空');\n          }\n          // 使用同一规范化方法更新数据\n          this.prefillActivity(res.result.data);\n          console.log('活动数据加载成功:', this.activityData);\n          // 如用户已加入，加载参与者信息\n          if (this.hasJoined) {\n            this.loadParticipantsInfo();\n          } else {\n            this.participantsInfo = [];\n          }\n        } else {\n          throw new Error(res.result.message || '获取活动详情失败');\n        }\n      } catch (err) {\n        console.error('加载活动详情失败:', {\n          message: err.message,\n          stack: err.stack,\n          activityId: this.activityId\n        });\n        \n        uni.showModal({\n          title: '加载失败',\n          content: `无法加载活动详情: ${err.message || '未知错误'}`,\n          showCancel: false,\n          confirmText: '返回',\n          success: () => {\n            uni.navigateBack();\n          }\n        });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n    async handleJoin() {\n      // 优先使用本地存储的 activityid（与进入详情页一致）\n      let id = '';\n      try { id = uni.getStorageSync('activityid') || ''; } catch (_) {}\n      if (!id) {\n        try { id = uni.getStorageSync('currentActivityId') || ''; } catch (_) {}\n      }\n      if (!id) id = this.activityData.id || this.activityId;\n      if (!id) return;\n      // 获取当前用户，并固定头像为本地图片\n      let username = '';\n      const avatar = '/static/icons/my.png';\n      try {\n        username = uni.getStorageSync('username') || '';\n        const userInfo = uni.getStorageSync('userInfo') || {};\n        if (!username && userInfo && userInfo.username) username = String(userInfo.username);\n      } catch (_) {}\n\n      if (!username) {\n        uni.showToast({ title: '请先登录后再报名', icon: 'none' });\n        setTimeout(() => uni.navigateTo({ url: '/pages/login/login' }), 600);\n        return;\n      }\n\n      // 本地已在活动中：切换为退出活动流程\n      try {\n        const list = Array.isArray(this.activityData.participants) ? this.activityData.participants : [];\n        const exists = list.some(p => String(p && p.username) === String(username));\n        if (exists) {\n          uni.showModal({\n            title: '退出活动',\n            content: '确定要退出该活动吗？',\n            success: async (res) => {\n              if (!res.confirm) return;\n              try {\n                uni.showLoading({ title: '退出中...', mask: true });\n                const out = await uniCloud.callFunction({\n                  name: 'leaveActivity',\n                  data: { id, username },\n                  timeout: 15000\n                });\n                const result = (out && out.result) || {};\n                if (result.code === 0) {\n                  // 本地更新：计数-1并移除该用户\n                  const next = Math.max(0, Number(this.activityData.joinedPeople || 0) - 1);\n                  this.activityData.joinedPeople = next;\n                  this.activityData.participants = list.filter(p => String(p && p.username) !== String(username));\n                  this.activityData.updatedAt = Date.now();\n                  uni.showToast({ title: '已退出活动', icon: 'success' });\n                  // 退出后清空参与者展示\n                  this.participantsInfo = [];\n                } else {\n                  uni.showToast({ title: result.message || '退出失败，请稍后重试', icon: 'none' });\n                }\n              } catch (e) {\n                console.error('退出失败:', e);\n                uni.showToast({ title: e.message || '退出失败，请检查网络', icon: 'none' });\n              } finally {\n                uni.hideLoading();\n              }\n            }\n          });\n          return;\n        }\n      } catch (_) {}\n\n      try {\n        uni.showLoading({ title: '报名中...', mask: true });\n        const canonicalId = id; // 直接使用本地已存的 _id\n\n        const res = await uniCloud.callFunction({\n          name: 'joinActivity',\n          data: { id: canonicalId, username, avatar },\n          timeout: 15000\n        });\n\n        const result = res && res.result ? res.result : {};\n        if (result.code === 0) {\n          // 成功：本地更新计数与参与者\n          const next = (Number(this.activityData.joinedPeople || 0) + 1);\n          this.activityData.joinedPeople = next;\n          if (Array.isArray(this.activityData.participants)) {\n            this.activityData.participants.push({ username, avatar, joinTime: Date.now() });\n          } else {\n            this.activityData.participants = [{ username, avatar, joinTime: Date.now() }];\n          }\n          this.activityData.updatedAt = Date.now();\n\n          uni.showToast({ title: '报名成功', icon: 'success' });\n          // 报名成功后加载参与者信息\n          this.loadParticipantsInfo();\n        } else {\n          const msg = result.message || '报名失败，请稍后重试';\n          uni.showToast({ title: msg, icon: 'none' });\n        }\n      } catch (err) {\n        console.error('报名失败:', err);\n        uni.showToast({ title: err.message || '报名失败，请检查网络', icon: 'none' });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n    goEditActivity() {\n      const id = this.activityData.id || this.activityId;\n      if (!id) return;\n      uni.navigateTo({\n        url: `/pages/editActivity/editActivity?id=${id}`,\n        success: (res) => {\n          // 预填数据到编辑页\n          res.eventChannel && res.eventChannel.emit('activityPrefill', { activity: this.activityData });\n        }\n      });\n    },\n    confirmDelete() {\n      uni.showModal({\n        title: '确认删除',\n        content: '删除后不可恢复，确认删除该活动吗？',\n        success: async (m) => {\n          if (m.confirm) {\n            await this.deleteActivity();\n          }\n        }\n      })\n    },\n    async deleteActivity() {\n      if (!this.activityId) return;\n      const username = uni.getStorageSync('username') || '';\n      try {\n        uni.showLoading({ title: '删除中...', mask: true });\n        const res = await uniCloud.callFunction({\n          name: 'deleteActivity',\n          data: { id: this.activityId, username }\n        });\n        if (res.result && res.result.code === 0) {\n          uni.showToast({ title: '删除成功', icon: 'success' });\n          setTimeout(() => {\n            // 返回首页\n            uni.switchTab({ url: '/pages/index/index', fail: () => uni.reLaunch({ url: '/pages/index/index' }) });\n          }, 800);\n        } else {\n          throw new Error((res.result && res.result.message) || '删除失败');\n        }\n      } catch (e) {\n        uni.showToast({ title: e.message || '删除失败', icon: 'none' });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n    goUserProfileTap(e) {\n      try {\n        const uname = e && e.currentTarget && e.currentTarget.dataset && e.currentTarget.dataset.username;\n        if (uname) {\n          this.goUserProfile(String(uname));\n        }\n      } catch (_) {}\n    },\n    goUserProfile(username) {\n      if (!username) return;\n      const url = `/pages/userInfo/userInfo?username=${encodeURIComponent(String(username))}`;\n      uni.navigateTo({ url });\n    },\n    async loadParticipantsInfo() {\n      try {\n        const id = this.activityData.id || this.activityId;\n        if (!id) return;\n        const res = await uniCloud.callFunction({\n          name: 'getActivityParticipants',\n          data: { id },\n          timeout: 10000\n        });\n        const r = (res && res.result) || {};\n        if (r.code === 0 && Array.isArray(r.data)) {\n          this.participantsInfo = r.data;\n        } else {\n          this.participantsInfo = [];\n        }\n      } catch (e) {\n        console.error('加载参与者信息失败:', e);\n        this.participantsInfo = [];\n      }\n    }\n  }\n}\n</script>\n\n<style>\n.detail-container {\n  padding: 30rpx;\n  background-color: #f5f7fa;\n  min-height: 100vh;\n}\n\n.title {\n  font-size: 40rpx;\n  font-weight: bold;\n  color: #333;\n  text-align: center;\n  margin: 30rpx 0;\n  padding-bottom: 20rpx;\n  border-bottom: 1rpx solid #eee;\n}\n\n.detail-card {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n  margin-bottom: 40rpx;\n}\n\n.detail-item {\n  margin-bottom: 25rpx;\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.detail-item.description {\n  flex-direction: column;\n}\n\n.detail-label {\n  font-size: 30rpx;\n  font-weight: bold;\n  color: #333;\n  margin-right: 10rpx;\n  line-height: 1.6;\n}\n\n.detail-value {\n  font-size: 28rpx;\n  color: #666;\n  line-height: 1.6;\n  flex: 1;\n}\n\n.join-button {\n  margin-top: 40rpx;\n  height: 90rpx;\n  background: linear-gradient(135deg, #4CAF50, #66BB6A);\n  color: white;\n  border-radius: 12rpx;\n  font-size: 32rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 6rpx 20rpx rgba(76, 175, 80, 0.3);\n}\n\n.join-button:active {\n  opacity: 0.9;\n}\n\n/* 退出活动按钮：红色样式覆盖 */\n.leave-button {\n  background: linear-gradient(135deg, #F56C6C, #F78989) !important;\n  box-shadow: 0 6rpx 20rpx rgba(245, 108, 108, 0.3) !important;\n}\n\n.owner-actions {\n  display: flex;\n  gap: 20rpx;\n  margin-top: 40rpx;\n}\n.edit-button {\n  flex: 1;\n  height: 90rpx;\n  background: #409EFF;\n  color: #fff;\n  border-radius: 12rpx;\n  font-size: 32rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.delete-button {\n  flex: 1;\n  height: 90rpx;\n  background: #F56C6C;\n  color: #fff;\n  border-radius: 12rpx;\n  font-size: 32rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* 参与者列表样式 */\n.participants-card {\n  margin-top: 30rpx;\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 24rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n}\n.participants-title {\n  font-size: 30rpx;\n  font-weight: 600;\n  color: #333;\n  margin-bottom: 16rpx;\n}\n.participants-item {\n  font-size: 28rpx;\n  color: #555;\n  padding: 10rpx 0;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n.participants-item:last-child {\n  border-bottom: none;\n}\n\n/* 类别标签样式（详情页） */\n.category-tag {\n  display: inline-block;\n  padding: 8rpx 20rpx;\n  font-size: 24rpx;\n  font-weight: 600;\n  line-height: 1;\n  color: #0A84FF;\n  background-color: rgba(10, 132, 255, 0.12);\n  border: 1rpx solid rgba(10, 132, 255, 0.35);\n  border-radius: 30rpx;\n  backdrop-filter: saturate(140%) blur(2rpx);\n}\n\n/* 标题行：类型在左，名称在右（整体居中） */\n.title-row {\n  display: flex;\n  align-items: baseline; /* 与标题文字基线对齐，保证同一水平 */\n  justify-content: flex-start; /* 与下方卡片左侧对齐 */\n  gap: 12rpx;\n  margin: 30rpx 0 10rpx 0;\n}\n\n.title-category {\n  margin-right: 8rpx;\n  transform: translateY(-2px);\n}\n</style>\n","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detailActivity.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detailActivity.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1755337402613\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}