{"version":3,"sources":["uni-app:///main.js","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/userInfo/userInfo.vue?9fd2","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/userInfo/userInfo.vue?b6fc","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/userInfo/userInfo.vue?b9d7","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/userInfo/userInfo.vue?7486","uni-app:///pages/userInfo/userInfo.vue","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/userInfo/userInfo.vue?5e65","webpack:////Users/Turbellarian/Documents/HBuilderProjects/find-friends-miniapp/pages/userInfo/userInfo.vue?765a"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","form","nickname","gender","bio","originalForm","genderOptions","saving","readOnly","viewUsername","computed","hasChanged","onLoad","methods","loadUserInfo","loadPublicUserInfo","username","uni","title","mask","uniCloud","name","timeout","res","r","d","icon","console","onGenderChange","saveUserInfo","userInfo","updatedUserInfo","setTimeout"],"mappings":"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","file":"pages/userInfo/userInfo.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/userInfo/userInfo.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./userInfo.vue?vue&type=template&id=4b7ab2a6&\"\nvar renderjs\nimport script from \"./userInfo.vue?vue&type=script&lang=js&\"\nexport * from \"./userInfo.vue?vue&type=script&lang=js&\"\nimport style0 from \"./userInfo.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/userInfo/userInfo.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./userInfo.vue?vue&type=template&id=4b7ab2a6&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./userInfo.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./userInfo.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"user-info-container\">\n    <view class=\"form-container\">\n      <!-- 头像（固定本地图片） -->\n      <view class=\"form-item\">\n        <text class=\"label\">头像</text>\n        <view class=\"avatar-fixed\">\n          <image \n            :src=\"'/static/icons/my.png'\" \n            mode=\"aspectFill\" \n            class=\"avatar\"\n          />\n        </view>\n      </view>\n      \n      <!-- 昵称 -->\n      <view class=\"form-item\">\n        <text class=\"label\">昵称</text>\n        <input \n          class=\"input\" \n          v-model=\"form.nickname\" \n          placeholder=\"请输入昵称\"\n          maxlength=\"20\"\n          :disabled=\"readOnly\"\n        />\n      </view>\n      \n      <!-- 性别 -->\n      <view class=\"form-item\">\n        <text class=\"label\">性别</text>\n        <picker \n          class=\"picker\" \n          mode=\"selector\" \n          :range=\"genderOptions\" \n          :value=\"form.gender\"\n          :disabled=\"readOnly\"\n          @change=\"onGenderChange\"\n        >\n          <view class=\"picker-text\">\n            {{ genderOptions[form.gender] || '请选择性别' }}\n          </view>\n        </picker>\n      </view>\n      \n      <!-- 个人简介 -->\n      <view class=\"form-item\">\n        <text class=\"label\">个人简介</text>\n        <textarea \n          class=\"textarea\" \n          v-model=\"form.bio\" \n          placeholder=\"介绍一下自己吧~\"\n          maxlength=\"200\"\n          auto-height\n          :disabled=\"readOnly\"\n        />\n      </view>\n      \n      <!-- 保存按钮 -->\n      <button \n        class=\"save-btn\" \n        :disabled=\"!hasChanged || saving\"\n        @click=\"saveUserInfo\"\n        v-if=\"!readOnly\"\n      >\n        {{ saving ? '保存中...' : '保存' }}\n      </button>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      form: {\n        nickname: '',\n        gender: 0, // 0-未知 1-男 2-女\n        bio: ''\n      },\n      originalForm: {},\n      genderOptions: ['未知', '男', '女'],\n      saving: false,\n      readOnly: false,\n      viewUsername: ''\n    };\n  },\n  computed: {\n    // 检查表单是否有变化\n    hasChanged() {\n      // 仅比较可编辑字段\n      const cur = { nickname: this.form.nickname, gender: this.form.gender, bio: this.form.bio };\n      const ori = { nickname: this.originalForm.nickname, gender: this.originalForm.gender, bio: this.originalForm.bio };\n      return JSON.stringify(cur) !== JSON.stringify(ori);\n    }\n  },\n  onLoad(options) {\n    try {\n      const cur = uni.getStorageSync('username') || '';\n      const paramU = options && options.username ? String(options.username) : '';\n      if (paramU && paramU !== cur) {\n        // 查看他人资料，进入只读模式\n        this.readOnly = true;\n        this.viewUsername = paramU;\n        this.loadPublicUserInfo(paramU);\n        return;\n      }\n    } catch (_) {}\n    // 自己资料，可编辑\n    this.readOnly = false;\n    this.viewUsername = '';\n    this.loadUserInfo();\n  },\n  methods: {\n    // 加载用户信息\n    loadUserInfo() {\n      const userInfo = uni.getStorageSync('userInfo');\n      if (userInfo) {\n        this.form = {\n          nickname: userInfo.nickname || userInfo.username || '',\n          gender: userInfo.gender || 0,\n          bio: userInfo.bio || ''\n        };\n        // 保存原始数据用于比较\n        this.originalForm = { ...this.form };\n      }\n    },\n    // 加载他人公开资料\n    async loadPublicUserInfo(username) {\n      if (!username) return;\n      try {\n        uni.showLoading({ title: '加载中...', mask: true });\n        const res = await uniCloud.callFunction({\n          name: 'getUserPublicInfo',\n          data: { username: String(username) },\n          timeout: 10000\n        });\n        const r = (res && res.result) || {};\n        if (r.code === 0 && r.data) {\n          const d = r.data;\n          this.form = {\n            nickname: d.nickname || d.username || '',\n            gender: typeof d.gender === 'number' ? d.gender : 0,\n            bio: d.bio || ''\n          };\n          this.originalForm = { ...this.form };\n        } else {\n          uni.showToast({ title: r.message || '加载失败', icon: 'none' });\n        }\n      } catch (e) {\n        console.error('加载公开资料失败:', e);\n        uni.showToast({ title: e.message || '加载失败', icon: 'none' });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n    \n    // 已移除头像更换与上传逻辑，头像固定为 /static/icons/my.png\n    \n    // 性别选择变化\n    onGenderChange(e) {\n      this.form.gender = parseInt(e.detail.value);\n    },\n    \n    // 保存用户信息\n    async saveUserInfo() {\n      if (!this.form.nickname.trim()) {\n        uni.showToast({\n          title: '请输入昵称',\n          icon: 'none'\n        });\n        return;\n      }\n\n      try {\n        this.saving = true;\n        // 仅允许更新昵称（username 不可更改）\n        const username = uni.getStorageSync('username');\n        if (!username) {\n          throw new Error('未登录或缺少用户名');\n        }\n        // 调用云函数仅更新昵称\n        const res = await uniCloud.callFunction({\n          name: 'updateUserInfo',\n          data: {\n            username: String(username),\n            nickname: this.form.nickname.trim(),\n            bio: String(this.form.bio || ''),\n            gender: Number.isInteger(this.form.gender) ? this.form.gender : parseInt(this.form.gender) || 0\n          },\n          timeout: 10000\n        });\n        \n        if (res.result.code === 0) {\n          // 更新本地存储的用户信息\n          const userInfo = uni.getStorageSync('userInfo');\n          const updatedUserInfo = { ...userInfo, nickname: this.form.nickname.trim(), bio: String(this.form.bio || ''), gender: (Number.isInteger(this.form.gender) ? this.form.gender : parseInt(this.form.gender) || 0) };\n          uni.setStorageSync('userInfo', updatedUserInfo);\n          \n          // 只更新原始昵称字段，保持其他字段不变\n          this.originalForm = { ...this.originalForm, nickname: this.form.nickname.trim(), bio: String(this.form.bio || ''), gender: (Number.isInteger(this.form.gender) ? this.form.gender : parseInt(this.form.gender) || 0) };\n          \n          uni.showToast({\n            title: '保存成功',\n            icon: 'success'\n          });\n          \n          // 返回上一页\n          setTimeout(() => {\n            uni.navigateBack();\n          }, 1500);\n        } else {\n          throw new Error(res.result.message || '保存失败');\n        }\n      } catch (err) {\n        console.error('保存用户信息失败:', err);\n        uni.showToast({\n          title: err.message || '保存失败，请重试',\n          icon: 'none'\n        });\n      } finally {\n        this.saving = false;\n      }\n    }\n  }\n};\n</script>\n\n<style>\n.user-info-container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n  padding: 20rpx;\n  box-sizing: border-box;\n}\n\n.form-container {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  margin-top: 20rpx;\n}\n\n.form-item {\n  margin-bottom: 40rpx;\n}\n\n.form-item .label {\n  display: block;\n  font-size: 28rpx;\n  color: #333;\n  margin-bottom: 20rpx;\n  font-weight: 500;\n}\n\n/* 头像固定容器 */\n.avatar-fixed {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 200rpx;\n  height: 200rpx;\n  border-radius: 50%;\n  background-color: #f5f5f5;\n  overflow: hidden;\n  margin: 0 auto;\n}\n\n.avatar {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n/* 移除上传提示与占位样式 */\n\n/* 输入框 */\n.input, .picker {\n  width: 100%;\n  height: 80rpx;\n  background-color: #f5f5f5;\n  border-radius: 8rpx;\n  padding: 0 24rpx;\n  font-size: 28rpx;\n  box-sizing: border-box;\n}\n\n.picker {\n  display: flex;\n  align-items: center;\n}\n\n.textarea {\n  width: 100%;\n  min-height: 160rpx;\n  background-color: #f5f5f5;\n  border-radius: 8rpx;\n  padding: 20rpx 24rpx;\n  font-size: 28rpx;\n  box-sizing: border-box;\n  line-height: 1.5;\n}\n\n/* 保存按钮 */\n.save-btn {\n  width: 100%;\n  height: 88rpx;\n  line-height: 88rpx;\n  background-color: #007AFF;\n  color: #fff;\n  font-size: 32rpx;\n  border-radius: 44rpx;\n  margin-top: 60rpx;\n  text-align: center;\n  border: none;\n}\n\n.save-btn[disabled] {\n  background-color: #a0cfff;\n  color: #fff;\n  opacity: 0.7;\n}\n</style>\n","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./userInfo.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./userInfo.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1755337402610\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}